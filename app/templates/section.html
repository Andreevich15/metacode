{% extends "base.html" %}
{% block content %}

<h1 class="text-3xl font-bold mb-8 text-center">{{ section_title }}</h1>

{% if mode == "cards" %}
  <!-- === Режим ПЛИТКИ (разделы с карточками) === -->
  <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 justify-center">
    {% for card in cards %}
    <a href="/subsection/{{ card.key }}"
       class="card rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all">
      <img src="{{ card.img }}" class="w-full h-40 object-cover" alt="{{ card.title }}">
      <div class="p-4 text-center">
        <h2 class="text-lg font-semibold">{{ card.title }}</h2>
      </div>
    </a>
    {% endfor %}
  </div>


{% elif mode == "content" %}
  <!-- === Режим ПОДРАЗДЕЛ === -->
  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 section-enter content-area">
    <!-- Левая панель -->
    <aside class="col-span-12 md:col-span-3 content-block">
      {% for t in topics %}
      <a href="/subsection/{{ sub_slug }}?topic={{ t | lower | replace(' ', '') }}" class="block-btn">
        {{ t }}
      </a>
      {% endfor %}
    </aside>

    <!-- Центральная колонка -->
    <div class="col-span-12 md:col-span-7 content-block">
      <h2 class="text-2xl font-semibold mb-4">О разделе</h2>
      <p class="leading-relaxed text-justify">{{ description }}</p>
    </div>

    <!-- Правая колонка -->
    <div class="col-span-12 md:col-span-2 content-block">
      <h2 class="text-2xl font-semibold mb-4">Что нового</h2>
      {% for item in news %}
      <div class="mb-4">
        <p class="font-medium hover:underline cursor-pointer news-link">{{ item.title }}</p>
        <p class="text-sm text-muted">{{ item.date }}</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Нижняя панель -->
  <div class="lesson-footer-nav flex flex-wrap justify-between items-center mt-10 pt-5 border-t border-gray-300 dark:border-gray-600">
    <a href="javascript:history.back()" class="lesson-nav-btn">← Назад к разделу</a>
  </div>



{% elif mode == "course" %}
  <!-- === Режим КУРС === -->
  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 section-enter">
    <div class="col-span-12 md:col-span-9 content-block">
      <p class="text-lg mb-6 text-center md:text-left">{{ description }}</p>

      {% for ch in chapters %}
        {% set ch_index = loop.index0 %}
        <div class="mb-6 p-5 rounded-xl border border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold mb-2">{{ ch.name }}</h2>
          <ul class="list-disc list-inside space-y-1">
            {% for l in ch.lessons %}
              <li>
                <a href="/lesson/{{ course_key }}/{{ ch_index }}/{{ loop.index0 }}"
                   class="hover:text-blue-600 dark:hover:text-blue-400 transition underline-offset-2 hover:underline">
                  {{ l.title if l.title else l }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    </div>

    <aside class="col-span-12 md:col-span-3 content-block">
      <h2 class="text-2xl font-semibold mb-4">Что нового</h2>
      {% for item in news %}
      <div class="mb-4">
        <p class="font-medium hover:underline cursor-pointer news-link">{{ item.title }}</p>
        <p class="text-sm text-muted">{{ item.date }}</p>
      </div>
      {% endfor %}
    </aside>
  </div>

  <!-- Нижняя панель -->
  <div class="lesson-footer-nav flex flex-wrap justify-between items-center mt-10 pt-5 border-t border-gray-300 dark:border-gray-600">
    <a href="javascript:history.back()" class="lesson-nav-btn">← Назад</a>
  </div>


{% elif mode == "lesson" %}
  <!-- === Режим УРОК (контент + список уроков главы) === -->
  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 section-enter">
    
    <!-- Левая колонка (список уроков) -->
    <aside class="col-span-12 md:col-span-3 content-block lesson-sidebar">
      <h2 class="text-lg font-semibold mb-3">{{ chapter_title }}</h2>
      {% for lesson in chapters[current_chapter].lessons %}
      <a href="/lesson/{{ course_key }}/{{ current_chapter }}/{{ loop.index0 }}"
         class="block block-btn {% if loop.index0 == current_lesson %}active{% endif %}">
        {{ lesson.title }}
      </a>
      {% endfor %}
    </aside>

    <!-- Контент урока -->
    <div class="col-span-12 md:col-span-9 content-block lesson-content-block">
      <h1 class="text-xl font-bold mb-3">{{ lesson_title }}</h1>
      <div class="lesson-content prose max-w-none text-[0.95rem] leading-relaxed">
        {{ lesson_content | safe }}
      </div>

      <!-- Нижняя панель навигации -->
      <div class="lesson-footer-nav flex flex-wrap justify-between items-center mt-10 pt-5 border-t border-gray-300 dark:border-gray-600">
        <a href="javascript:history.back()" class="lesson-nav-btn">← Назад</a>
        <a href="/subsection/web?topic={{ course_key }}" class="lesson-nav-btn">Содержание</a>
        {% set next_lesson = current_lesson + 1 %}
        {% if next_lesson < chapters[current_chapter].lessons|length %}
        <a href="/lesson/{{ course_key }}/{{ current_chapter }}/{{ next_lesson }}" class="lesson-nav-btn">Следующий урок →</a>
        {% endif %}
      </div>
    </div>
  </div>
{% endif %}

{% endblock %}